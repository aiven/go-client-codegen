// Code generated by Aiven. DO NOT EDIT.

package cmk

import (
	"context"
	"encoding/json"
	"fmt"
	"net/url"
	"time"
)

type Handler interface {
	// CMKAccessCheckTrigger trigger an access check on CMK
	// POST /v1/project/{project}/secrets/cmks/{cmk_id}/access_check
	// https://api.aiven.io/doc/#tag/Secrets/operation/CMKAccessCheckTrigger
	CMKAccessCheckTrigger(ctx context.Context, project string, cmkid string) (*CMKAccessCheckTriggerOut, error)

	// CMKAccessorsList list CMK accessors
	// GET /v1/project/{project}/secrets/cmks/accessors
	// https://api.aiven.io/doc/#tag/Secrets/operation/CMKAccessorsList
	CMKAccessorsList(ctx context.Context, project string) (*CMKAccessorsListOut, error)

	// CMKCreate create new CMK
	// POST /v1/project/{project}/secrets/cmks
	// https://api.aiven.io/doc/#tag/Project/operation/CMKCreate
	CMKCreate(ctx context.Context, project string, in *CMKCreateIn) (*CMKCreateOut, error)

	// CMKDelete delete CMK
	// DELETE /v1/project/{project}/secrets/cmks/{cmk_id}
	// https://api.aiven.io/doc/#tag/Secrets/operation/CMKDelete
	CMKDelete(ctx context.Context, project string, cmkid string) (*CMKDeleteOut, error)

	// CMKGet get CMK details
	// GET /v1/project/{project}/secrets/cmks/{cmk_id}
	// https://api.aiven.io/doc/#tag/Secrets/operation/CMKGet
	CMKGet(ctx context.Context, project string, cmkid string) (*CMKGetOut, error)

	// CMKUpdate update CMK
	// POST /v1/project/{project}/secrets/cmks/{cmk_id}
	// https://api.aiven.io/doc/#tag/Secrets/operation/CMKUpdate
	CMKUpdate(ctx context.Context, project string, cmkid string, in *CMKUpdateIn) (*CMKUpdateOut, error)
}

// doer http client
type doer interface {
	Do(ctx context.Context, operationID, method, path string, in any, query ...[2]string) ([]byte, error)
}

func NewHandler(doer doer) CMKHandler {
	return CMKHandler{doer}
}

type CMKHandler struct {
	doer doer
}

func (h *CMKHandler) CMKAccessCheckTrigger(ctx context.Context, project string, cmkid string) (*CMKAccessCheckTriggerOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks/%s/access_check", url.PathEscape(project), url.PathEscape(cmkid))
	b, err := h.doer.Do(ctx, "CMKAccessCheckTrigger", "POST", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(cmkAccessCheckTriggerOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.CMK, nil
}
func (h *CMKHandler) CMKAccessorsList(ctx context.Context, project string) (*CMKAccessorsListOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks/accessors", url.PathEscape(project))
	b, err := h.doer.Do(ctx, "CMKAccessorsList", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(cmkAccessorsListOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.Accessors, nil
}
func (h *CMKHandler) CMKCreate(ctx context.Context, project string, in *CMKCreateIn) (*CMKCreateOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks", url.PathEscape(project))
	b, err := h.doer.Do(ctx, "CMKCreate", "POST", path, in)
	if err != nil {
		return nil, err
	}
	out := new(cmkCreateOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.CMK, nil
}
func (h *CMKHandler) CMKDelete(ctx context.Context, project string, cmkid string) (*CMKDeleteOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks/%s", url.PathEscape(project), url.PathEscape(cmkid))
	b, err := h.doer.Do(ctx, "CMKDelete", "DELETE", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(cmkDeleteOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.CMK, nil
}
func (h *CMKHandler) CMKGet(ctx context.Context, project string, cmkid string) (*CMKGetOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks/%s", url.PathEscape(project), url.PathEscape(cmkid))
	b, err := h.doer.Do(ctx, "CMKGet", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(cmkGetOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.CMK, nil
}
func (h *CMKHandler) CMKUpdate(ctx context.Context, project string, cmkid string, in *CMKUpdateIn) (*CMKUpdateOut, error) {
	path := fmt.Sprintf("/v1/project/%s/secrets/cmks/%s", url.PathEscape(project), url.PathEscape(cmkid))
	b, err := h.doer.Do(ctx, "CMKUpdate", "POST", path, in)
	if err != nil {
		return nil, err
	}
	out := new(cmkUpdateOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return &out.CMK, nil
}

// AwsOut CMKAccessorsAWS
type AwsOut struct {
	Principal string `json:"principal"`
}

// CMKAccessCheckTriggerOut CMK
type CMKAccessCheckTriggerOut struct {
	CreatedAt  time.Time `json:"created_at"`  // Created At
	DefaultCMK bool      `json:"default_cmk"` // Default Cmk
	Id         string    `json:"id"`          // ID
	Resource   string    `json:"resource"`
	UpdatedAt  time.Time `json:"updated_at"` // Updated At
}

// CMKAccessorsListOut CMKAccessors
type CMKAccessorsListOut struct {
	Aws *AwsOut `json:"aws,omitempty"` // CMKAccessorsAWS
	Gcp GcpOut  `json:"gcp"`           // CMKAccessorsGCP
	Oci OciOut  `json:"oci"`           // CMKAccessorsOCI
}

// CMKCreateIn CMKCreateRequestBody
type CMKCreateIn struct {
	DefaultCMK *bool        `json:"default_cmk,omitempty"` // Mark the created CMK as default for all newly created services.
	Provider   ProviderType `json:"provider"`              // CMK provider
	Resource   string       `json:"resource"`              // Resource name
}

// CMKCreateOut CMK
type CMKCreateOut struct {
	CreatedAt  time.Time     `json:"created_at"`  // Created at
	DefaultCMK bool          `json:"default_cmk"` // CMK is used as a default for all newly created services.
	Id         string        `json:"id"`          // Customer Managed Key identifier (CMK ID)
	Provider   ProviderType  `json:"provider"`    // CMK provider
	Resource   string        `json:"resource"`    // Resource name
	Status     CMKStatusType `json:"status"`      // Status
	UpdatedAt  time.Time     `json:"updated_at"`  // Updated at
}

// CMKDeleteOut CMK
type CMKDeleteOut struct {
	CreatedAt  time.Time `json:"created_at"`  // Created At
	DefaultCMK bool      `json:"default_cmk"` // Default Cmk
	Id         string    `json:"id"`          // ID
	Resource   string    `json:"resource"`
	UpdatedAt  time.Time `json:"updated_at"` // Updated At
}

// CMKGetOut CMK
type CMKGetOut struct {
	CreatedAt  time.Time `json:"created_at"`  // Created At
	DefaultCMK bool      `json:"default_cmk"` // Default Cmk
	Id         string    `json:"id"`          // ID
	Resource   string    `json:"resource"`
	UpdatedAt  time.Time `json:"updated_at"` // Updated At
}
type CMKStatusType string

const (
	CMKStatusTypeCurrent CMKStatusType = "current"
	CMKStatusTypeDeleted CMKStatusType = "deleted"
	CMKStatusTypeOld     CMKStatusType = "old"
)

func CMKStatusTypeChoices() []string {
	return []string{"current", "deleted", "old"}
}

// CMKUpdateIn CMKUpdateRequestBody
type CMKUpdateIn struct {
	DefaultCMK *bool `json:"default_cmk,omitempty"` // Mark the created CMK as default for all newly created services.
}

// CMKUpdateOut CMK
type CMKUpdateOut struct {
	CreatedAt  time.Time `json:"created_at"`  // Created At
	DefaultCMK bool      `json:"default_cmk"` // Default Cmk
	Id         string    `json:"id"`          // ID
	Resource   string    `json:"resource"`
	UpdatedAt  time.Time `json:"updated_at"` // Updated At
}

// GcpOut CMKAccessorsGCP
type GcpOut struct {
	AccessGroup string `json:"access_group"` // Access Group
}

// OciOut CMKAccessorsOCI
type OciOut struct {
	AccessGroup string `json:"access_group"` // Access Group
}
type ProviderType string

const (
	ProviderTypeAws ProviderType = "aws"
	ProviderTypeGcp ProviderType = "gcp"
	ProviderTypeOci ProviderType = "oci"
)

func ProviderTypeChoices() []string {
	return []string{"aws", "gcp", "oci"}
}

// cmkAccessCheckTriggerOut CMKAccessCheckTriggerResponse
type cmkAccessCheckTriggerOut struct {
	CMK CMKAccessCheckTriggerOut `json:"cmk"` // CMK
}

// cmkAccessorsListOut CMKAccessorsListResponse
type cmkAccessorsListOut struct {
	Accessors CMKAccessorsListOut `json:"accessors"` // CMKAccessors
}

// cmkCreateOut CMKCreateResponse
type cmkCreateOut struct {
	CMK CMKCreateOut `json:"cmk"` // CMK
}

// cmkDeleteOut CMKDeleteResponse
type cmkDeleteOut struct {
	CMK CMKDeleteOut `json:"cmk"` // CMK
}

// cmkGetOut CMKGetResponse
type cmkGetOut struct {
	CMK CMKGetOut `json:"cmk"` // CMK
}

// cmkUpdateOut CMKUpdateResponse
type cmkUpdateOut struct {
	CMK CMKUpdateOut `json:"cmk"` // CMK
}
