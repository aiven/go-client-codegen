// Code generated by Aiven. DO NOT EDIT.

package flinkjob

import (
	"context"
	"encoding/json"
	"fmt"
)

type Handler interface {
	// ServiceFlinkJobDetails get a Flink job info
	// GET /project/{project}/service/{service_name}/flink/job/{job_id}
	// https://api.aiven.io/doc/#tag/Service:_Flink/operation/ServiceFlinkJobDetails
	ServiceFlinkJobDetails(ctx context.Context, project string, serviceName string, jobId string) (*ServiceFlinkJobDetailsOut, error)

	// ServiceFlinkJobsList get all Flink jobs
	// GET /project/{project}/service/{service_name}/flink/job
	// https://api.aiven.io/doc/#tag/Service:_Flink/operation/ServiceFlinkJobsList
	ServiceFlinkJobsList(ctx context.Context, project string, serviceName string) ([]JobOut, error)
}

func NewHandler(doer doer) FlinkJobHandler {
	return FlinkJobHandler{doer}
}

type doer interface {
	Do(ctx context.Context, operationID, method, path string, v any) ([]byte, error)
}

type FlinkJobHandler struct {
	doer doer
}

func (h *FlinkJobHandler) ServiceFlinkJobDetails(ctx context.Context, project string, serviceName string, jobId string) (*ServiceFlinkJobDetailsOut, error) {
	path := fmt.Sprintf("/project/%s/service/%s/flink/job/%s", project, serviceName, jobId)
	b, err := h.doer.Do(ctx, "ServiceFlinkJobDetails", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(ServiceFlinkJobDetailsOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return out, nil
}
func (h *FlinkJobHandler) ServiceFlinkJobsList(ctx context.Context, project string, serviceName string) ([]JobOut, error) {
	path := fmt.Sprintf("/project/%s/service/%s/flink/job", project, serviceName)
	b, err := h.doer.Do(ctx, "ServiceFlinkJobsList", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(serviceFlinkJobsListOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return out.Jobs, nil
}

type JobOut struct {
	Id     string `json:"id,omitempty"`
	Status string `json:"status,omitempty"`
}
type ServiceFlinkJobDetailsOut struct {
	Duration       *int             `json:"duration,omitempty"`
	EndTime        *int             `json:"end-time,omitempty"`
	IsStoppable    *bool            `json:"isStoppable,omitempty"`
	Jid            string           `json:"jid,omitempty"`
	MaxParallelism *int             `json:"maxParallelism,omitempty"`
	Name           string           `json:"name,omitempty"`
	Now            *int             `json:"now,omitempty"`
	Plan           map[string]any   `json:"plan,omitempty"`
	StartTime      *int             `json:"start-time,omitempty"`
	State          string           `json:"state,omitempty"`
	StatusCounts   *StatusCountsOut `json:"status-counts,omitempty"`
	Timestamps     map[string]any   `json:"timestamps,omitempty"`
	Vertices       []map[string]any `json:"vertices,omitempty"`
}
type StatusCountsOut struct {
	Canceled     *int `json:"CANCELED,omitempty"`
	Canceling    *int `json:"CANCELING,omitempty"`
	Created      *int `json:"CREATED,omitempty"`
	Deploying    *int `json:"DEPLOYING,omitempty"`
	Failed       *int `json:"FAILED,omitempty"`
	Finished     *int `json:"FINISHED,omitempty"`
	Initializing *int `json:"INITIALIZING,omitempty"`
	Reconciling  *int `json:"RECONCILING,omitempty"`
	Running      *int `json:"RUNNING,omitempty"`
	Scheduled    *int `json:"SCHEDULED,omitempty"`
}
type serviceFlinkJobsListOut struct {
	Jobs []JobOut `json:"jobs,omitempty"`
}
