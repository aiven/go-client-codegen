// Code generated by Aiven. DO NOT EDIT.

package flinkjob

import (
	"context"
	"encoding/json"
	"fmt"
)

type Handler interface {
	// ServiceFlinkJobDetails get a Flink job info
	// GET /v1/project/{project}/service/{service_name}/flink/job/{job_id}
	// https://api.aiven.io/doc/#tag/Service:_Flink/operation/ServiceFlinkJobDetails
	ServiceFlinkJobDetails(ctx context.Context, project string, serviceName string, jobId string) (*ServiceFlinkJobDetailsOut, error)

	// ServiceFlinkJobsList get all Flink jobs
	// GET /v1/project/{project}/service/{service_name}/flink/job
	// https://api.aiven.io/doc/#tag/Service:_Flink/operation/ServiceFlinkJobsList
	ServiceFlinkJobsList(ctx context.Context, project string, serviceName string) ([]JobOut, error)
}

func NewHandler(doer doer) FlinkJobHandler {
	return FlinkJobHandler{doer}
}

type doer interface {
	Do(ctx context.Context, operationID, method, path string, v any) ([]byte, error)
}

type FlinkJobHandler struct {
	doer doer
}

func (h *FlinkJobHandler) ServiceFlinkJobDetails(ctx context.Context, project string, serviceName string, jobId string) (*ServiceFlinkJobDetailsOut, error) {
	path := fmt.Sprintf("/v1/project/%s/service/%s/flink/job/%s", project, serviceName, jobId)
	b, err := h.doer.Do(ctx, "ServiceFlinkJobDetails", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(ServiceFlinkJobDetailsOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return out, nil
}
func (h *FlinkJobHandler) ServiceFlinkJobsList(ctx context.Context, project string, serviceName string) ([]JobOut, error) {
	path := fmt.Sprintf("/v1/project/%s/service/%s/flink/job", project, serviceName)
	b, err := h.doer.Do(ctx, "ServiceFlinkJobsList", "GET", path, nil)
	if err != nil {
		return nil, err
	}
	out := new(serviceFlinkJobsListOut)
	err = json.Unmarshal(b, out)
	if err != nil {
		return nil, err
	}
	return out.Jobs, nil
}

type JobOut struct {
	Id     string        `json:"id,omitempty"`
	Status JobStatusType `json:"status,omitempty"`
}
type JobStatusType string

const (
	JobStatusTypeInitializing JobStatusType = "INITIALIZING"
	JobStatusTypeCreated      JobStatusType = "CREATED"
	JobStatusTypeRunning      JobStatusType = "RUNNING"
	JobStatusTypeFailing      JobStatusType = "FAILING"
	JobStatusTypeFailed       JobStatusType = "FAILED"
	JobStatusTypeCancelling   JobStatusType = "CANCELLING"
	JobStatusTypeCanceled     JobStatusType = "CANCELED"
	JobStatusTypeFinished     JobStatusType = "FINISHED"
	JobStatusTypeRestarting   JobStatusType = "RESTARTING"
	JobStatusTypeSuspended    JobStatusType = "SUSPENDED"
	JobStatusTypeReconciling  JobStatusType = "RECONCILING"
)

func JobStatusTypeChoices() []string {
	return []string{"INITIALIZING", "CREATED", "RUNNING", "FAILING", "FAILED", "CANCELLING", "CANCELED", "FINISHED", "RESTARTING", "SUSPENDED", "RECONCILING"}
}

type ServiceFlinkJobDetailsOut struct {
	Duration       *int                            `json:"duration,omitempty"`
	EndTime        *int                            `json:"end-time,omitempty"`
	IsStoppable    *bool                           `json:"isStoppable,omitempty"`
	Jid            string                          `json:"jid,omitempty"`
	MaxParallelism *int                            `json:"maxParallelism,omitempty"`
	Name           string                          `json:"name,omitempty"`
	Now            *int                            `json:"now,omitempty"`
	Plan           map[string]any                  `json:"plan,omitempty"`
	StartTime      *int                            `json:"start-time,omitempty"`
	State          ServiceFlinkJobDetailsStateType `json:"state,omitempty"`
	StatusCounts   *StatusCountsOut                `json:"status-counts,omitempty"`
	Timestamps     map[string]any                  `json:"timestamps,omitempty"`
	Vertices       []map[string]any                `json:"vertices,omitempty"`
}
type ServiceFlinkJobDetailsStateType string

const (
	ServiceFlinkJobDetailsStateTypeInitializing ServiceFlinkJobDetailsStateType = "INITIALIZING"
	ServiceFlinkJobDetailsStateTypeCreated      ServiceFlinkJobDetailsStateType = "CREATED"
	ServiceFlinkJobDetailsStateTypeRunning      ServiceFlinkJobDetailsStateType = "RUNNING"
	ServiceFlinkJobDetailsStateTypeFailing      ServiceFlinkJobDetailsStateType = "FAILING"
	ServiceFlinkJobDetailsStateTypeFailed       ServiceFlinkJobDetailsStateType = "FAILED"
	ServiceFlinkJobDetailsStateTypeCancelling   ServiceFlinkJobDetailsStateType = "CANCELLING"
	ServiceFlinkJobDetailsStateTypeCanceled     ServiceFlinkJobDetailsStateType = "CANCELED"
	ServiceFlinkJobDetailsStateTypeFinished     ServiceFlinkJobDetailsStateType = "FINISHED"
	ServiceFlinkJobDetailsStateTypeRestarting   ServiceFlinkJobDetailsStateType = "RESTARTING"
	ServiceFlinkJobDetailsStateTypeSuspended    ServiceFlinkJobDetailsStateType = "SUSPENDED"
	ServiceFlinkJobDetailsStateTypeReconciling  ServiceFlinkJobDetailsStateType = "RECONCILING"
)

func ServiceFlinkJobDetailsStateTypeChoices() []string {
	return []string{"INITIALIZING", "CREATED", "RUNNING", "FAILING", "FAILED", "CANCELLING", "CANCELED", "FINISHED", "RESTARTING", "SUSPENDED", "RECONCILING"}
}

type StatusCountsOut struct {
	Canceled     *int `json:"CANCELED,omitempty"`
	Canceling    *int `json:"CANCELING,omitempty"`
	Created      *int `json:"CREATED,omitempty"`
	Deploying    *int `json:"DEPLOYING,omitempty"`
	Failed       *int `json:"FAILED,omitempty"`
	Finished     *int `json:"FINISHED,omitempty"`
	Initializing *int `json:"INITIALIZING,omitempty"`
	Reconciling  *int `json:"RECONCILING,omitempty"`
	Running      *int `json:"RUNNING,omitempty"`
	Scheduled    *int `json:"SCHEDULED,omitempty"`
}
type serviceFlinkJobsListOut struct {
	Jobs []JobOut `json:"jobs,omitempty"`
}
